<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Profile</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0b0f13; --fg:#eaf1f8; --muted:#9eb1c7; --card:#121821; --accent:#5fb3ff; }
    * { box-sizing: border-box; }
    body { margin:0; background:linear-gradient(135deg,#0b0f13,#121821); color:var(--fg); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto; }
    .wrap { min-height:100svh; display:grid; place-items:center; padding:24px; }
    .card { width:min(860px,100%); background:var(--card); border-radius:20px; padding:28px; box-shadow:0 10px 40px rgba(0,0,0,0.35); }
    h1 { margin:0 0 8px; font-size:clamp(24px,5vw,40px); }
    p.muted { color:var(--muted); margin:0 0 14px; }
    .row { display:flex; gap:16px; flex-wrap:wrap; }
    .btn { display:inline-flex; align-items:center; justify-content:center; padding:12px 16px; border-radius:12px; background:#1a2330; color:var(--fg); text-decoration:none; border:1px solid #273246; }
    .btn:hover { border-color:var(--accent); }
    .section { margin-top:18px; padding-top:18px; border-top:1px solid #1e2633; }
    .media { display:grid; gap:12px; }
    iframe, img { width:100%; border:0; border-radius:12px; }
    footer { margin-top:18px; color:#7f93ad; font-size:13px; }
  </style>
</head>
<body>
  <div class="wrap">
    <main class="card">
      <h1 id="headline">Loading…</h1>
      <p class="muted" id="sub">A smart, auto-updating profile.</p>

      <div class="row" id="buttons"></div>

      <div class="section media" id="youtube"></div>
      <div class="section media" id="instagram"></div>

      <div class="section">
        <h3>Current Offer</h3>
        <p id="offer">…</p>
      </div>

      <div class="section">
        <h3>Contact</h3>
        <div class="row" id="contact"></div>
      </div>

      <footer id="updated"></footer>
    </main>
  </div>

  <script>
  (async function () {
    console.log("Smart Profile: script started");

    async function load() {
      try {
        const url = './content/content.json?_=' + Date.now();
        console.log("Fetching:", url);
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error("Fetch failed: " + res.status + " " + res.statusText);

        const data = await res.json();
        console.log("Loaded JSON:", data);

        document.title = (data.brand || 'Smart Profile') + ' — Smart Profile';
        document.getElementById('headline').textContent = data.headline || data.brand || 'Smart Profile';
        document.getElementById('offer').textContent = data.offer || '';

        if (data.updatedAt) {
          const footer = document.getElementById('updated');
          if (footer) footer.textContent = 'Last updated: ' + new Date(data.updatedAt).toLocaleString();
        }

        const buttons = document.getElementById('buttons');
        (data.buttons || []).forEach(b => {
          const a = document.createElement('a');
          a.className = 'btn';
          a.href = b.href;
          a.textContent = b.label;
          a.target = '_blank';
          buttons.appendChild(a);
        });

        const contact = document.getElementById('contact');
        (data.contact || []).forEach(b => {
          const a = document.createElement('a');
          a.className = 'btn';
          a.href = b.href;
          a.textContent = b.label;
          contact.appendChild(a);
        });

        const y = document.getElementById('youtube');
        if (data.youtube?.videoId) {
          const iframe = document.createElement('iframe');
          iframe.width = '560';
          iframe.height = '315';
          iframe.src = 'https://www.youtube.com/embed/' + data.youtube.videoId;
          iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
          iframe.allowFullscreen = true;
          y.appendChild(iframe);
        } else {
          console.warn("No YouTube videoId in JSON.");
        }

        const ig = document.getElementById('instagram');
        if (data.instagram?.url) {
          const a = document.createElement('a');
          a.href = data.instagram.url;
          a.target = '_blank';
          const img = document.createElement('img');
          img.src = data.instagram.thumb || data.instagram.mediaUrl;
          img.alt = 'Latest Instagram';
          a.appendChild(img);
          ig.appendChild(a);
        }
      } catch (err) {
        console.error("Load error:", err);
        const h1 = document.getElementById('headline');
        h1.textContent = 'Could not load content';
        const sub = document.getElementById('sub');
        if (sub) sub.textContent = String(err);
      }
    }

    load();
  })();
  </script>
</body>
</html>
